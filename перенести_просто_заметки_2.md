### Первый опыт починки ФС

Темплейт с дебианом в гнсе после нескольких минут работы начал говорить, что его ФС в `read-only`, ниче не могу создать. Почитал, это может быть при:
 - монтировании системы с опцией `ro`, а не `rw` (очевидно?)
 - ошибках ФС, когда че-то где-то несоответствует (такое было, когда сломался хв-рейд на PVE)

Немного исходных данных, у моего темплейта структура была такая:
```bash
root@docker:~# lsblk
NAME                  MAJ:MIN RM  SIZE RO TYPE MOUNTPOINTS
fd0                     2:0    1    4K  0 disk
sda                     8:0    0   30G  0 disk
├─sda1                  8:1    0  487M  0 part /boot
├─sda2                  8:2    0    1K  0 part
└─sda5                  8:5    0 29.5G  0 part
  ├─debian--vg-root   254:0    0 28.6G  0 lvm  /
  └─debian--vg-swap_1 254:1    0  980M  0 lvm  [SWAP]
```

___Решение здесь___ - [сайт](https://serverfault.com/questions/304416/i-cant-delete-files-rm-cannot-remove-x-read-only-file-system)

Не точные шаги, история не сохранилась:
  1. ___Сомнительный шаг___. Что-то перемонтировал, или просто посмотрел, я не понял:
```bash
mount -o remount,rw /
```

  2. Прошлый шаг ничего не дал, поэтому полез делать:
```bash
fsck /dev/debian-rg/root
# Или
fsck /dev/debian-rg/root -f
```

Именно оно вроде бы помогло, я начал тыкать везде `y`, на то чтобы пофиксить ошибку или нет. На починенной системе оно говорит, что все смонтированно и не будет продолжать.

После у меня отвалился гит (клон и все остальное), потому что ошибки у ФС были в файлах каких-то либ для курла. Срало, что нет там какой-то библиотеки. Помогло просто переустановить пакетики с этими либами:
```bash
apt purge libcurl3-gnutls
apt install libcurl3-gnutls
```

---

### Distrobox в WSL

Сначала добавил чистый Debian в WSL, все как обычно. Из необычного - сменил дефолтного юзера с рута на `admin`. Все потому что:
 - Distrobox в редакции у меня - нафиг не работает от рута, все параметры ему по барабану;
 - А так как иксы не работают после `su - admin`, то надо логиниться сразу в дефолтного пользователя;

Тестилось все на __Debian 12__ (`.10` или `.11`).

#### Установка, тесты:
1. Установил `Distrobox`. Он там сразу в зависимостях тянет и `podman`, и вообще все что ему надо:
```bash
apt install distrobox
```

2. Сделал новый контейнер, в нем для теста `xeyes` из `x11-apps`:
```bash
distrobox create --image docker.io/archlinux:latest --name arch
sudo pacman -S xorg-eyes
xeyes
```

На этом моменте можно уже запускать всякое. Далее приступил к `BoxBuddy` и мукам с ним.
```bash
apt install flatpak
flatpak remote-add --user --if-not-exists flathub https://flathub.org/repo/flathub.flatpakrepo
flatpak install flathub io.github.dvlv.boxbuddyrs
flatpak run io.github.dvlv.boxbuddyrs
```

Далее оно запустится, но почти ниче работать не будет. Для этого всего нужно установить какие-то либы из гнома, а подтянулись они у меня после установки `gnome-terminal`:
```bash
apt install gnome-terminal
```

___Сноска___: я тестил `vscode` на Debian-контейнере, и он крашился, когда нужно было открыть проводник. Ни один не помог, а открываться оно начало только после установки тех самых гномовских либ. Та же самая история и с `BoxBuddy` - ни один терминал не запускался, только `gnome-terminal`.

---

### Запуск приложений с Distrobox'а

Как скачать и запускать приложения - понятно. Но постоянно заходить в контейнер это бред, поэтому в хостовую систему можно это приложение прокинуть так:
```bash
alias firefox-ubuntu='distrobox enter ubuntu-box -- firefox'
```
Вариант очень простой, можно даже сказать не очень то и костыльный.

Прямо из винды есть вот такой варик (без алиаса, наглядно):
```powershell
wsl -d WSL-Distro -u admin distrobox-enter ubuntu-box -- firefox
```

В ярлыке это будет выглядеть примерно так:
```bash
C:\Windows\System32\wsl.exe -d Distrobox distrobox-enter Export-App -- chromium
```

Самый ___человеческий___ вариант: сделать экспорт приложухи в хост-систему (из контейнера в WSL). В КОНТЕЙНЕРЕ надо прописать:
```bash
distrobox-export --bin $(which chromium) --export-path $HOME/.local/bin
```

Вроде бы как, оно не просто копирует сам бинарь, а че-то типа симлинка (как я понимаю). В конце путь, где будет лежать этот самый типа "симлинк". По итогу результат тот же, но вроде как более правильный.ы

> Алиасы работают только в интерактивных шеллах. Поэтому, при запуске WSL и передаче команды в параметрах нужно ручками вначале указывать `bash`, а после что шелл будет интерактивный. Далее уже сам алиас. То есть так: `wsl -d <DISTRO> bash -ic ff`, где `ff` - алиас на запуск ФФ внутри контейнера у дистробокса.

---

### Тестирование GUI-приложений в WSL

1. Все линуксовые окна открываются в родном разрешении, рассмотреть че-то нереально. Эти приложения можно масштабировать при запуске. 
> [Источник](https://www.linuxquestions.org/questions/linux-newbie-8/how-to-scale-each-individual-app-on-the-monitor-with-respect-to-dpi-4175735532/#:~:text=For%20KDE/QT%20apps%20such%20as%20Kate%2C%20you%20can%20scale%20apps%20with%20an%20environmental%20variable.)

 - `QT_SCALE_FACTOR=1.5 kate` - для `KDE/QT`. Просто задается значение сразу вместе с запуском
 - `GDK_SCALE=2 GDK_DPI_SCALE=1.25 gimp` - для `GNOME/GDK`. При запуске `тундроптица` первое значение роли не сыграло, масштбирование было за счет второго.

Чтобы каждый раз это не прописывать, можно добавить в `.profile` или куда-нить там:
> Данные значения мне понравились, потому что при других то проводник гномовский высрется на 500%, то еще че. А вот при них - норм.
```bash
export GDK_DPI_SCALE=1.25
export QT_SCALE_FACTOR=1.5
```

#### Непосредственно парочка программ, которые потестились

1. `Thunderbird`. Работает с GDK, очень даже шустренько. Фризы есть, но терпимо.
2. `SourceGit`. Работает с QT, растягивание окна - жуть как плохо работает. Сам интерфейс работает четко, идеально.

---

### Использование `xdg-...`

 - ___Открыть приложение___ (аналогично двойному нажатию ЛКМ):
```bash
xdg-open <app/file/dir>
```
> Оно само подберет GUI-приложение, которое нужно открыть, исходя из того, какой MIME-тип имеет файл (директория тоже файл) и какое приложение назначено на этот MIME-тип

 - ___Узнать MIME-тип файла___ - `xdg-mime query filetype <app/file/dir>`
 - ___Узнать приложение для MIME-типа___ - `xdg-mime query default <mime-type>`

### Смена X-Сервера в `WSL2`:

По дефолту всегда работает `WSLg`, даже если указать другой X-сервер - будет работать именно `WSLg`.

 - Отключить `WSLg`:
```ini
# C:/Users/admin/.wslconfig
guiApplications = false
```

 - Указать адрес, где запущен X-сервер (значения в зависимости от настроек x-сервера):
> Внутри контейнера
```bash
export LIBGL_ALWAYS_INDIRECT=1
export DISPLAY=<IP>:0.0
```

 - Все должно работать. X-сервак надо настроить на публичный доступ.