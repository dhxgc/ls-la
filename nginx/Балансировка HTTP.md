### Балансировка HTTP

---

### 1. Простейшая реализация (`Round-Robin`)
> [1] - https://docs.nginx.com/nginx/admin-guide/load-balancer/http-load-balancer/

Конфига: 
```nginx
# /etc/nginx/sites-enabled/proxy
upstream cluster {
    server 192.168.122.201 weight=3;
    server 192.168.122.202 backup;
}
server {
    listen 80;
    location / {
        proxy_pass http://cluster;
    }
}
```

#### Кратко:
 - Делается блок `upstream NAME {...}`, в нем описываются конечные сервера
 - После работа идет как с обычным прокси - `proxy_pass http://NAME;`

#### Детали:
 - два сервера, каждый отдает страницу со своим `IP`
 - `weight=3` задает вес сервера в указанном апстриме. По умолчанию - `1`. 
 - В этой конфигурации (если убрать у второго `backup`) - `.201` сервер принимал бы 3 запроса, 4-ый бы отдавался на `.202`. Следующие запросы будут распределяться аналогичным образом.
 - `backup` указывает какие сервера в апстриме являются запасными. Если выходят все основные сервера из апстрима, то запросы отправляются именно на сервера с указанием `backup`.
 - Переключение на запасные сервера происходит не сразу, я ждал около минуты, оно как-то там раздуплялось